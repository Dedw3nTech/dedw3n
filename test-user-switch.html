<!DOCTYPE html>
<html>
<head>
    <title>User Switch Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { margin: 10px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .status { margin: 20px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>User Perspective Test</h1>
    <div class="status" id="status">Current User: Loading...</div>
    
    <button onclick="loginAsSerruti()">Login as Serruti (User 9)</button>
    <button onclick="loginAsFernando()">Login as Fernando (User 6)</button>
    <button onclick="openMessages()">Open Messages</button>
    <button onclick="logout()">Logout</button>

    <script>
        async function loginAsSerruti() {
            try {
                const response = await fetch('/api/auth/logout', { method: 'POST' });
                localStorage.setItem('userId', '9');
                localStorage.setItem('userType', 'serruti');
                document.getElementById('status').innerText = 'Current User: Serruti (ID: 9)';
                window.location.href = '/messages';
            } catch (error) {
                console.error('Login error:', error);
            }
        }

        async function loginAsFernando() {
            try {
                const response = await fetch('/api/auth/logout', { method: 'POST' });
                localStorage.setItem('userId', '6');
                localStorage.setItem('userType', 'fernando');
                document.getElementById('status').innerText = 'Current User: Fernando (ID: 6)';
                window.location.href = '/messages';
            } catch (error) {
                console.error('Login error:', error);
            }
        }

        async function openMessages() {
            window.location.href = '/messages';
        }

        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                localStorage.clear();
                document.getElementById('status').innerText = 'Current User: Logged out';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Check current user status
        const userId = localStorage.getItem('userId');
        const userType = localStorage.getItem('userType');
        if (userId && userType) {
            document.getElementById('status').innerText = `Current User: ${userType} (ID: ${userId})`;
        } else {
            document.getElementById('status').innerText = 'Current User: Not logged in';
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dedw Ltd. Image Upload Test</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f9f9f9;
    }
    
    h1, h2 {
      color: #2c3e50;
    }
    
    .company-logo {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .company-logo img {
      max-width: 200px;
    }
    
    .panel {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 30px;
    }
    
    .tab-container {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      background-color: #f1f1f1;
      border: 1px solid #ddd;
      border-bottom: none;
      border-radius: 5px 5px 0 0;
      margin-right: 5px;
    }
    
    .tab.active {
      background-color: #4CAF50;
      color: white;
      border-color: #4CAF50;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    .preview {
      max-width: 300px;
      max-height: 300px;
      border: 1px solid #ddd;
      margin-top: 10px;
      display: none;
    }
    
    .result {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      white-space: pre-wrap;
      overflow: auto;
      max-height: 300px;
      display: none;
    }
    
    .result.success {
      border-left: 5px solid #4CAF50;
    }
    
    .result.error {
      border-left: 5px solid #f44336;
    }
    
    .progress {
      width: 100%;
      background-color: #f1f1f1;
      border-radius: 4px;
      margin-top: 10px;
      display: none;
    }
    
    .progress-bar {
      height: 20px;
      background-color: #4CAF50;
      border-radius: 4px;
      text-align: center;
      color: white;
      line-height: 20px;
      width: 0%;
    }
    
    .loader {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #4CAF50;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="company-logo">
    <img src="/uploads/logo.png" alt="Dedw Ltd. Logo" onerror="this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAyCAYAAAAZUZThAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDA2IDc5LjE2NDc1MywgMjAyMS8wMi8xNS0xMTo1MjoxMyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjMgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RjRCQjFEMDM3QUYzMTFFQzk0NjZBNTdGM0ZBMjA1NUMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RjRCQjFEMDQ3QUYzMTFFQzk0NjZBNTdGM0ZBMjA1NUMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpGNEJCMUQwMTdBRjMxMUVDOTQ2NkE1N0YzRkEyMDU1QyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpGNEJCMUQwMjdBRjMxMUVDOTQ2NkE1N0YzRkEyMDU1QyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtsrVQcAAAoCSURBVHja7J15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'">
  </div>
  
  <h1>Image Upload Test</h1>
  
  <div class="panel">
    <div class="tab-container">
      <div class="tab active" data-tab="simple">Simple Upload</div>
      <div class="tab" data-tab="chunked">Chunked Upload</div>
      <div class="tab" data-tab="test">Test Image</div>
    </div>
    
    <!-- Simple Upload Tab -->
    <div class="tab-content active" id="simple-content">
      <h2>Upload an Image</h2>
      <div class="form-group">
        <label for="image-type">Image Type:</label>
        <select id="image-type">
          <option value="product">Product Image</option>
          <option value="profile">Profile Image</option>
          <option value="post">Post Image</option>
        </select>
      </div>
      <div class="form-group">
        <label for="image-input">Select Image:</label>
        <input type="file" id="image-input" accept="image/*">
      </div>
      <div class="form-group">
        <img id="image-preview" class="preview">
      </div>
      <button id="upload-btn" disabled>Upload Image</button>
      <div id="simple-loader" class="loader"></div>
      <div id="simple-result" class="result"></div>
    </div>
    
    <!-- Chunked Upload Tab -->
    <div class="tab-content" id="chunked-content">
      <h2>Chunked Image Upload</h2>
      <p>Use for larger images (automatically splits into smaller chunks)</p>
      <div class="form-group">
        <label for="chunked-image-type">Image Type:</label>
        <select id="chunked-image-type">
          <option value="product">Product Image</option>
          <option value="profile">Profile Image</option>
          <option value="post">Post Image</option>
        </select>
      </div>
      <div class="form-group">
        <label for="chunked-image-input">Select Image:</label>
        <input type="file" id="chunked-image-input" accept="image/*">
      </div>
      <div class="form-group">
        <img id="chunked-image-preview" class="preview">
      </div>
      <button id="chunked-upload-btn" disabled>Upload Image</button>
      <div id="chunked-progress" class="progress">
        <div id="chunked-progress-bar" class="progress-bar">0%</div>
      </div>
      <div id="chunked-result" class="result"></div>
    </div>
    
    <!-- Test Image Tab -->
    <div class="tab-content" id="test-content">
      <h2>Generate Test Image</h2>
      <p>Creates a simple colored square for testing purposes</p>
      <button id="test-btn">Generate Test Image</button>
      <div id="test-loader" class="loader"></div>
      <div id="test-result" class="result"></div>
    </div>
  </div>
  
  <script>
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs and contents
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked tab and corresponding content
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}-content`).classList.add('active');
      });
    });
    
    // Simple Upload
    const imageInput = document.getElementById('image-input');
    const imagePreview = document.getElementById('image-preview');
    const uploadBtn = document.getElementById('upload-btn');
    const simpleResult = document.getElementById('simple-result');
    const simpleLoader = document.getElementById('simple-loader');
    
    imageInput.addEventListener('change', () => {
      const file = imageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.src = e.target.result;
          imagePreview.style.display = 'block';
          uploadBtn.disabled = false;
        };
        reader.readAsDataURL(file);
      }
    });
    
    uploadBtn.addEventListener('click', async () => {
      simpleLoader.style.display = 'block';
      simpleResult.style.display = 'none';
      
      try {
        const imageType = document.getElementById('image-type').value;
        
        const response = await fetch('/api/image/upload', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            imageData: imagePreview.src,
            imageType: imageType
          })
        });
        
        const data = await response.json();
        simpleLoader.style.display = 'none';
        simpleResult.style.display = 'block';
        
        if (data.success) {
          simpleResult.className = 'result success';
          simpleResult.innerHTML = `
            <h3>Upload Successful!</h3>
            <p><strong>Image URL:</strong> ${data.imageUrl}</p>
            <p><strong>Image Type:</strong> ${data.imageType}</p>
            <p><strong>MIME Type:</strong> ${data.mimeType}</p>
            <p><strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
            <p><strong>Filename:</strong> ${data.filename}</p>
            <img src="${data.imageUrl}" style="max-width: 300px; max-height: 300px; margin-top: 10px;">
          `;
        } else {
          simpleResult.className = 'result error';
          simpleResult.innerHTML = `
            <h3>Upload Failed</h3>
            <p><strong>Error:</strong> ${data.message}</p>
            ${data.error ? `<p><strong>Details:</strong> ${data.error}</p>` : ''}
          `;
        }
      } catch (error) {
        simpleLoader.style.display = 'none';
        simpleResult.style.display = 'block';
        simpleResult.className = 'result error';
        simpleResult.innerHTML = `
          <h3>Upload Failed</h3>
          <p><strong>Error:</strong> ${error.message}</p>
        `;
      }
    });
    
    // Chunked Upload
    const chunkSize = 1024 * 50; // 50KB chunks
    const chunkedImageInput = document.getElementById('chunked-image-input');
    const chunkedImagePreview = document.getElementById('chunked-image-preview');
    const chunkedUploadBtn = document.getElementById('chunked-upload-btn');
    const chunkedProgress = document.getElementById('chunked-progress');
    const chunkedProgressBar = document.getElementById('chunked-progress-bar');
    const chunkedResult = document.getElementById('chunked-result');
    
    chunkedImageInput.addEventListener('change', () => {
      const file = chunkedImageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          chunkedImagePreview.src = e.target.result;
          chunkedImagePreview.style.display = 'block';
          chunkedUploadBtn.disabled = false;
        };
        reader.readAsDataURL(file);
      }
    });
    
    chunkedUploadBtn.addEventListener('click', async () => {
      const file = chunkedImageInput.files[0];
      if (!file) return;
      
      chunkedUploadBtn.disabled = true;
      chunkedProgress.style.display = 'block';
      chunkedResult.style.display = 'none';
      
      try {
        const imageType = document.getElementById('chunked-image-type').value;
        const fileId = Date.now().toString();
        const totalChunks = Math.ceil(chunkedImagePreview.src.length / chunkSize);
        
        for (let i = 0; i < totalChunks; i++) {
          const start = i * chunkSize;
          const end = Math.min(start + chunkSize, chunkedImagePreview.src.length);
          const chunk = chunkedImagePreview.src.substring(start, end);
          
          const response = await fetch('/api/image/chunked-upload', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              chunkIndex: i,
              totalChunks: totalChunks,
              fileId: fileId,
              chunk: chunk,
              imageType: imageType
            })
          });
          
          const data = await response.json();
          
          if (!data.success) {
            throw new Error(data.message);
          }
          
          // Update progress
          const progress = Math.round((i + 1) / totalChunks * 100);
          chunkedProgressBar.style.width = `${progress}%`;
          chunkedProgressBar.textContent = `${progress}%`;
          
          // If this is the last chunk, show the result
          if (i === totalChunks - 1) {
            chunkedResult.style.display = 'block';
            chunkedResult.className = 'result success';
            chunkedResult.innerHTML = `
              <h3>Upload Successful!</h3>
              <p><strong>Image URL:</strong> ${data.imageUrl}</p>
              <p><strong>Image Type:</strong> ${data.imageType}</p>
              <p><strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
              <p><strong>Filename:</strong> ${data.filename}</p>
              <img src="${data.imageUrl}" style="max-width: 300px; max-height: 300px; margin-top: 10px;">
            `;
          }
        }
      } catch (error) {
        chunkedResult.style.display = 'block';
        chunkedResult.className = 'result error';
        chunkedResult.innerHTML = `
          <h3>Upload Failed</h3>
          <p><strong>Error:</strong> ${error.message}</p>
        `;
      } finally {
        chunkedUploadBtn.disabled = false;
      }
    });
    
    // Test Image
    const testBtn = document.getElementById('test-btn');
    const testLoader = document.getElementById('test-loader');
    const testResult = document.getElementById('test-result');
    
    testBtn.addEventListener('click', async () => {
      testLoader.style.display = 'block';
      testResult.style.display = 'none';
      
      try {
        const response = await fetch('/api/image/test', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        testLoader.style.display = 'none';
        testResult.style.display = 'block';
        
        if (data.success) {
          testResult.className = 'result success';
          testResult.innerHTML = `
            <h3>Test Image Created!</h3>
            <p><strong>Image URL:</strong> ${data.imageUrl}</p>
            <p><strong>Image Type:</strong> ${data.imageType}</p>
            <p><strong>Color:</strong> ${data.color}</p>
            <p><strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
            <div style="width: 100px; height: 100px; background-color: ${data.color}; margin: 10px 0;"></div>
            <img src="${data.imageUrl}" style="max-width: 300px; max-height: 300px;">
          `;
        } else {
          testResult.className = 'result error';
          testResult.innerHTML = `
            <h3>Test Failed</h3>
            <p><strong>Error:</strong> ${data.message}</p>
            ${data.error ? `<p><strong>Details:</strong> ${data.error}</p>` : ''}
          `;
        }
      } catch (error) {
        testLoader.style.display = 'none';
        testResult.style.display = 'block';
        testResult.className = 'result error';
        testResult.innerHTML = `
          <h3>Test Failed</h3>
          <p><strong>Error:</strong> ${error.message}</p>
        `;
      }
    });
  </script>
</body>
</html>